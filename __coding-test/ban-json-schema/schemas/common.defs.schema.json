{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ban.local/schemas/common.defs.schema.json",
  "$defs": {
    "langueNom": {
      "type": "object",
      "required": [
        "codeLangue",
        "nom"
      ],
      "additionalProperties": false,
      "properties": {
        "codeLangue": {
          "type": "string",
          "pattern": "^(?:[A-Za-z]{2}|[A-Za-z]{3}|[A-Za-z]{2,3}-[A-Za-z0-9]+)$",
          "description": "ISO 639-1 (2 lettres, toléré), ISO 639-2 (3 lettres, attendu) ou tag IETF simplifié (2–3 lettres + '-' + suffixe)."
        },
        "nom": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "pointGeometry": {
      "type": "object",
      "required": [
        "type",
        "coordinates"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "Point"
        },
        "coordinates": {
          "type": "array",
          "minItems": 2,
          "maxItems": 2,
          "prefixItems": [
            {
              "type": "number",
              "minimum": -180,
              "maximum": 180,
              "description": "Longitude (WGS84)"
            },
            {
              "type": "number",
              "minimum": -90,
              "maximum": 90,
              "description": "Latitude (WGS84)"
            }
          ],
          "items": false,
          "description": "Coordonnées WGS84 [lon, lat]."
        }
      }
    },
    "position": {
      "type": "object",
      "required": [
        "type",
        "geometry"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string"
        },
        "geometry": {
          "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/pointGeometry"
        }
      }
    },
    "positionComplementaireItem": {
      "type": "object",
      "required": [
        "type",
        "geometry"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string"
        },
        "geometry": {
          "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/pointGeometry"
        }
      }
    },
    "commune": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "nom",
        "idCommune",
        "codeInsee",
        "nomsMultilinguesCommune",
        "dateDerniereIntegrationBan",
        "statutCommune"
      ],
      "properties": {
        "nom": {
          "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/langueNom"
        },
        "idCommune": {
          "type": "string",
          "format": "uuid"
        },
        "codeInsee": {
          "type": "string",
          "pattern": "^[0-9A-Z]{5}$"
        },
        "nomsMultilinguesCommune": {
          "type": "array",
          "items": {
            "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/langueNom"
          }
        },
        "dateDerniereIntegrationBan": {
          "type": "string",
          "format": "date-time"
        },
        "statutCommune": {
          "type": "string"
        }
      }
    },
    "odonyme": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "idOdonyme",
        "idCommune",
        "cleInterop",
        "nom",
        "nomsMultilinguesOdonyme"
      ],
      "properties": {
        "idOdonyme": {
          "type": "string",
          "format": "uuid"
        },
        "idCommune": {
          "type": "string",
          "format": "uuid"
        },
        "cleInterop": {
          "type": "string",
          "minLength": 1,
          "pattern": "^[0-9A-Z]{5}_[^_]+$",
          "$comment": "Clé en voie de dépréciation. Format : codeInsee_toponyme. Underscore interdit dans les segments."
        },
        "nom": {
          "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/langueNom"
        },
        "nomsMultilinguesOdonyme": {
          "type": "array",
          "items": {
            "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/langueNom"
          }
        }
      }
    },
    "adresse": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "position",
        "idAdresseCommunale",
        "cleInterop",
        "idVoiePlaceLieudit",
        "idCommune",
        "certification",
        "positionsComplementaires",
        "dateDebut",
        "dateDerniereMiseAJour",
        "sources",
        "parcellesCadastrales",
        "codePostal"
      ],
      "properties": {
        "position": {
          "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/position"
        },
        "idAdresseCommunale": {
          "type": "string",
          "format": "uuid"
        },
        "cleInterop": {
          "type": "string",
          "minLength": 1,
          "pattern": "^[0-9A-Z]{5}_[^_]+_(?:[0-9]+|x)(?:_[^_]+)?$",
          "$comment": "Clé en voie de dépréciation. Format : codeInsee_toponyme_numero|x(_suffix). Underscore interdit dans les segments."
        },
        "idVoiePlaceLieudit": {
          "type": "string",
          "format": "uuid"
        },
        "idLieuditComplementaire": {
          "type": [
            "string",
            "null"
          ],
          "format": "uuid"
        },
        "idCommune": {
          "type": "string",
          "format": "uuid"
        },
        "codeInseeCommuneHistorique": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^[0-9A-Z]{5}$"
        },
        "numero": {
          "type": "integer",
          "minimum": 0,
          "maximum": 99998
        },
        "indiceRepetition": {
          "type": [
            "string",
            "null"
          ],
          "minLength": 1
        },
        "certification": {
          "type": "boolean"
        },
        "positionsComplementaires": {
          "type": "array",
          "minItems": 0,
          "default": [],
          "items": {
            "$ref": "https://ban.local/schemas/common.defs.schema.json#/$defs/positionComplementaireItem"
          }
        },
        "dateDebut": {
          "type": "string",
          "format": "date"
        },
        "dateDerniereMiseAJour": {
          "type": "string",
          "format": "date-time"
        },
        "sources": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "parcellesCadastrales": {
          "type": "array",
          "minItems": 0,
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "codePostal": {
          "type": "string",
          "pattern": "^[0-9]{5}$"
        }
      }
    }
  }
}